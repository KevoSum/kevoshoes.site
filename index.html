<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="KEVO Shoes - Premium Shoe E-Commerce Store" />
    <title>KEVO Shoes - Premium Footwear</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background-color: #fff;
            color: #333;
            line-height: 1.6;
        }

        header {
            background-color: #000;
            color: #fff;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        header h1 {
            font-size: 24px;
            font-weight: 700;
            letter-spacing: 2px;
        }

        nav a {
            color: #fff;
            text-decoration: none;
            margin: 0 20px;
            font-weight: 600;
            font-size: 14px;
            text-transform: uppercase;
            transition: color 0.3s;
        }

        nav a:hover {
            color: #ccc;
        }

        .search-container {
            display: flex;
            align-items: center;
            background-color: #fff;
            border-radius: 25px;
            padding: 8px 16px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(255,255,255,0.1);
        }

        .search-container:hover {
            box-shadow: 0 2px 12px rgba(255,255,255,0.2);
            transform: scale(1.05);
        }

        .search-container input {
            border: none;
            outline: none;
            background: transparent;
            color: #000;
            width: 200px;
            font-size: 14px;
            font-weight: 600;
            padding: 0 10px;
        }

        .search-container input::placeholder {
            color: #999;
        }

        .search-icon {
            color: #000;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .search-icon:hover {
            transform: scale(1.2) rotate(15deg);
            color: #333;
        }

        .search-icon:active {
            animation: searchPulse 0.6s ease;
        }

        .search-results {
            position: absolute;
            top: 100%;
            right: 0;
            background: #fff;
            border: 2px solid #000;
            border-radius: 8px;
            margin-top: 10px;
            min-width: 250px;
            max-height: 400px;
            overflow-y: auto;
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
            z-index: 1000;
            display: none;
        }

        .search-results.active {
            display: block;
            animation: slideDown 0.3s ease;
        }

        .search-result-item {
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .search-result-item:hover {
            background-color: #f5f5f5;
            padding-left: 20px;
            font-weight: 600;
        }

        .search-result-emoji {
            font-size: 24px;
        }

        .search-result-text {
            flex: 1;
        }

        .search-result-name {
            font-weight: 600;
            color: #000;
        }

        .search-result-price {
            font-size: 12px;
            color: #999;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes searchPulse {
            0% {
                transform: scale(1.2);
            }
            50% {
                transform: scale(1.4);
            }
            100% {
                transform: scale(1.2);
            }
        }

        nav {
            position: relative;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .cart-icon-container {
            position: relative;
            cursor: pointer;
            font-size: 24px;
            transition: all 0.3s ease;
            user-select: none;
        }

        .cart-icon-container:hover {
            transform: scale(1.2);
        }

        .cart-icon-container:active {
            animation: cartBounce 0.6s ease;
        }

        @keyframes cartBounce {
            0%, 100% { transform: scale(1.2); }
            50% { transform: scale(1.4); }
        }

        .cart-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: #ff0000;
            color: #fff;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 700;
            animation: badgePop 0.3s ease;
        }

        @keyframes badgePop {
            0% {
                transform: scale(0);
            }
            50% {
                transform: scale(1.3);
            }
            100% {
                transform: scale(1);
            }
        }

        .cart-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: flex-end;
            z-index: 2000;
            animation: fadeInOverlay 0.3s ease;
        }

        .cart-modal.active {
            display: flex;
        }

        @keyframes fadeInOverlay {
            from {
                background-color: rgba(0, 0, 0, 0);
            }
            to {
                background-color: rgba(0, 0, 0, 0.5);
            }
        }

        .cart-panel {
            background: #fff;
            width: 100%;
            max-width: 400px;
            height: 100%;
            display: flex;
            flex-direction: column;
            box-shadow: -4px 0 16px rgba(0,0,0,0.2);
            animation: slideInCart 0.3s ease;
        }

        @keyframes slideInCart {
            from {
                transform: translateX(100%);
            }
            to {
                transform: translateX(0);
            }
        }

        .cart-header {
            background-color: #000;
            color: #fff;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 20px;
            font-weight: 700;
            border-bottom: 2px solid #333;
        }

        .cart-close {
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .cart-close:hover {
            transform: rotate(90deg);
        }

        .cart-items {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .cart-empty {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
            color: #999;
        }

        .cart-empty-emoji {
            font-size: 60px;
            margin-bottom: 15px;
        }

        .cart-item {
            background-color: #f9f9f9;
            padding: 15px;
            margin-bottom: 12px;
            border-radius: 8px;
            border-left: 4px solid #000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            animation: slideInItem 0.3s ease;
        }

        .cart-qty-controls {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
        }

        .qty-btn {
            background: #000;
            color: #fff;
            border: none;
            width: 28px;
            height: 28px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 700;
        }

        .qty-value {
            width: 48px;
            text-align: center;
            font-weight: 700;
            padding: 6px 4px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            background: #fff;
            -moz-appearance: textfield;
        }

        .qty-value::-webkit-outer-spin-button,
        .qty-value::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .cart-item-line-total {
            font-weight: 800;
            font-size: 14px;
            color: #000;
            margin-top: 8px;
        }

        @keyframes slideInItem {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .cart-item-info {
            flex: 1;
        }

        .cart-item-name {
            font-weight: 700;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .cart-item-price {
            font-size: 12px;
            color: #666;
        }

        .cart-item-remove {
            background-color: #ff4444;
            color: #fff;
            border: none;
            border-radius: 4px;
            padding: 6px 12px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 700;
            transition: all 0.3s ease;
            margin-left: 10px;
        }

        .cart-item-remove:hover {
            background-color: #cc0000;
            transform: scale(1.1);
        }

        .cart-footer {
            border-top: 2px solid #e0e0e0;
            padding: 20px;
            background-color: #f9f9f9;
        }

        .cart-total {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .cart-actions {
            display: flex;
            gap: 10px;
        }

        .cart-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 4px;
            font-weight: 700;
            cursor: pointer;
            text-transform: uppercase;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .cart-checkout-btn {
            background-color: #000;
            color: #fff;
        }

        .cart-checkout-btn:hover {
            background-color: #333;
            transform: scale(1.05);
        }

        .cart-continue-btn {
            background-color: #ddd;
            color: #000;
        }

        .cart-continue-btn:hover {
            background-color: #bbb;
        }

        .no-results {
            text-align: center;
            padding: 40px 20px;
            font-size: 18px;
            color: #999;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .hero {
            background: linear-gradient(135deg, #000 0%, #333 100%);
            color: #fff;
            padding: 80px 20px;
            text-align: center;
            border-radius: 8px;
            margin-bottom: 60px;
        }

        .hero h2 {
            font-size: 48px;
            font-weight: 700;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 3px;
        }

        .hero p {
            font-size: 18px;
            margin-bottom: 30px;
            color: #ccc;
        }

        .btn {
            background-color: #000;
            color: #fff;
            padding: 14px 40px;
            border: 2px solid #000;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }

        .btn:hover {
            background-color: #fff;
            color: #000;
        }

        .products {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 30px;
            margin: 60px 0;
        }

        .product-card {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: all 0.3s;
        }

        .product-card:hover {
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
            transform: translateY(-5px);
        }

        .product-image {
            width: 100%;
            height: 300px;
            background-color: #f5f5f5;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 80px;
            overflow: hidden;
            position: relative;
        }

        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            padding: 10px;
            background-color: #ffffff;
        }

        .product-image.emoji {
            font-size: 80px;
        }

        .product-info {
            padding: 20px;
        }

        .product-name {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .product-price {
            font-size: 18px;
            font-weight: 700;
            color: #000;
            margin-bottom: 15px;
        }

        .product-btn {
            width: 100%;
            background-color: #000;
            color: #fff;
            border: none;
            padding: 12px;
            border-radius: 4px;
            font-weight: 700;
            cursor: pointer;
            text-transform: uppercase;
            font-size: 12px;
            transition: all 0.3s;
        }

        .product-btn:hover {
            background-color: #333;
        }

        .section-title {
            font-size: 32px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin: 60px 0 40px 0;
            border-bottom: 2px solid #000;
            padding-bottom: 15px;
        }

        footer {
            background-color: #111;
            color: #fff;
            padding: 40px 20px;
            margin-top: 80px;
            text-align: center;
            border-top: 1px solid #333;
        }

        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 30px;
            margin: 40px 0;
        }

        .feature {
            text-align: center;
            padding: 20px;
        }

        .feature-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .feature h3 {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .feature p {
            color: #666;
            font-size: 14px;
        }

        @media (max-width: 768px) {
            header {
                flex-direction: column;
                gap: 20px;
            }

            nav {
                display: flex;
                gap: 10px;
                flex-wrap: wrap;
                justify-content: center;
            }

            nav a {
                margin: 0 10px;
                font-size: 12px;
            }

            .hero h2 {
                font-size: 32px;
            }

            .products {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 20px;
            }

            .product-image {
                height: 200px;
                font-size: 60px;
            }
        }
        /* Checkout modal (Jumia-like layout) */
        .checkout-modal {
            position: fixed;
            inset: 0;
            background-color: rgba(0,0,0,0.6);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
        }
        .checkout-modal.active { display: flex; }
        .checkout-panel {
            width: 100%;
            max-width: 980px;
            background: #fff;
            border-radius: 8px;
            overflow: hidden;
            display: grid;
            grid-template-columns: 1fr 380px;
            box-shadow: 0 12px 48px rgba(0,0,0,0.3);
            animation: slideUp 0.25s ease;
        }
        @keyframes slideUp { from { transform: translateY(20px); opacity:0 } to { transform: translateY(0); opacity:1 } }
        .checkout-left { padding: 28px; }
        .checkout-right { background:#f7f7f7; padding: 20px; border-left:1px solid #e6e6e6; }
        .checkout-header { display:flex; justify-content:space-between; align-items:center; margin-bottom: 12px; }
        .checkout-close { cursor:pointer; font-size:20px; }
        .checkout-form label { display:block; font-weight:700; margin-top:12px; font-size:13px; }
        .checkout-form input, .checkout-form textarea, .checkout-form select {
            width:100%; padding:10px; margin-top:6px; border:1px solid #e0e0e0; border-radius:6px; font-size:14px;
        }
        .checkout-actions { display:flex; gap:10px; margin-top:18px; }
        .btn-primary { background:#ff6a00; color:#fff; border:none; padding:12px 14px; font-weight:700; border-radius:6px; cursor:pointer; }
        .btn-secondary { background:#fff; color:#000; border:1px solid #ccc; padding:12px 14px; border-radius:6px; cursor:pointer; }
        .order-summary { font-size:14px; }
        .order-item { display:flex; justify-content:space-between; padding:8px 0; border-bottom:1px dashed #e0e0e0; }
        .summary-total { display:flex; justify-content:space-between; font-weight:800; margin-top:12px; font-size:16px; }
    </style>
</head>
<body>
    <header>
        <h1>KEVO SHOES</h1>
        <nav>
            <a href="#home">Home</a>
            <a href="#products">Products</a>
            <a href="#about">About</a>
            <a href="#contact">Contact</a>
            <div class="search-container">
                <input type="text" id="searchInput" placeholder="Search shoes...">
                <span class="search-icon">üîç</span>
                <div class="search-results" id="searchResults"></div>
            </div>
            <div class="cart-icon-container" id="cartIcon">
                üõí
                <div class="cart-badge" id="cartBadge">0</div>
            </div>
        </nav>

        <div class="cart-modal" id="cartModal">
            <div class="cart-panel">
                <div class="cart-header">
                    <span>üõí Shopping Cart</span>
                    <span class="cart-close" id="cartClose">‚úï</span>
                </div>
                <div class="cart-items" id="cartItems">
                    <div class="cart-empty">
                        <div class="cart-empty-emoji">üõí</div>
                        <p>Your cart is empty</p>
                    </div>
                </div>
                <div class="cart-footer">
                    <div class="cart-total">
                        <span>Total:</span>
                        <span id="cartTotal">KSH 0</span>
                    </div>
                    <div class="cart-actions">
                        <button class="cart-btn cart-continue-btn" id="cartContinue">Continue Shopping</button>
                        <button class="cart-btn cart-checkout-btn" id="cartCheckout">Checkout</button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <section class="hero" id="home">
            <h2>Premium Shoe Collection</h2>
            <p>Discover the latest trends in footwear with KEVO Shoes</p>
            <button class="btn">Shop Now</button>
        </section>

        <section class="features">
            <div class="feature">
                <div class="feature-icon">üöö</div>
                <h3>Fast Shipping</h3>
                <p>Get your shoes delivered quickly</p>
            </div>
            <div class="feature">
                <div class="feature-icon">üîí</div>
                <h3>Secure Payment</h3>
                <p>Safe and encrypted transactions</p>
            </div>
            <div class="feature">
                <div class="feature-icon">‚Ü©Ô∏è</div>
                <h3>Easy Returns</h3>
                <p>30-day return guarantee</p>
            </div>
            <div class="feature">
                <div class="feature-icon">üí¨</div>
                <h3>24/7 Support</h3>
                <p>Always here to help you</p>
            </div>
        </section>

        <h2 class="section-title" id="products">Featured Products</h2>

        <div class="products" id="productsContainer"></div>

        <h2 class="section-title" id="about">About KEVO Shoes</h2>
        <p style="font-size: 16px; line-height: 1.8; margin-bottom: 40px;">
            Welcome to KEVO Shoes, your premier destination for premium footwear. We offer a carefully curated collection of shoes for every occasion, from casual sneakers to formal dress shoes. Our mission is to provide high-quality footwear that combines style, comfort, and durability. With our fast shipping, secure payment options, and 24/7 customer support, we ensure your shopping experience is exceptional.
        </p>

        <h2 class="section-title" id="contact">Get in Touch</h2>
        <div style="max-width: 600px; margin: 0 auto; padding: 40px; background: #f9f9f9; border-radius: 8px;">
            <p style="margin-bottom: 20px;"><strong>Email:</strong> support@kevoshoes.com</p>
            <p style="margin-bottom: 20px;"><strong>Phone:</strong> +1 (800) 123-4567</p>
            <p style="margin-bottom: 20px;"><strong>Hours:</strong> Monday - Friday, 9AM - 6PM EST</p>
            <button class="btn">Contact Us</button>
        </div>
    </div>

    <footer>
        <p>&copy; 2024 KEVO Shoes. All rights reserved.</p>
        <p style="margin-top: 10px; font-size: 12px; color: #999;">
            Made with ‚ù§Ô∏è for shoe lovers worldwide
        </p>
    </footer>

    <script>
        // Load products from admin data or use defaults
        // Products come from admin data (stored as numbers in KSH). Defaults below use KSH integer values.
        let products = JSON.parse(localStorage.getItem('kevoShoes')) || [
            { name: 'Classic Sneaker', price: 8999, emoji: 'üëü' },
            { name: 'Premium Boot', price: 12999, emoji: 'ü•æ' },
            { name: 'Formal Shoe', price: 9999, emoji: 'üëû' },
            { name: 'Running Shoe', price: 11999, emoji: 'üèÉ' },
            { name: 'Casual Slip-On', price: 7999, emoji: 'üë†' },
            { name: 'Basketball Shoe', price: 13999, emoji: '‚õπÔ∏è' }
        ];

        // Format price for display
        function formatPrice(price) {
            if (typeof price === 'number') {
                return 'KSH ' + Math.round(price).toLocaleString();
            }
            // If price is a string like 'KSH 1000' or other, return as-is
            return price;
        }

        // Cart state
        let cart = JSON.parse(localStorage.getItem('kevoCart')) || [];

        // DOM elements
        const cartIcon = document.getElementById('cartIcon');
        const cartModal = document.getElementById('cartModal');
        const cartClose = document.getElementById('cartClose');
        const cartItemsContainer = document.getElementById('cartItems');
        const cartBadge = document.getElementById('cartBadge');
        const cartTotal = document.getElementById('cartTotal');
        const cartContinue = document.getElementById('cartContinue');
        const cartCheckout = document.getElementById('cartCheckout');
        const searchInput = document.getElementById('searchInput');
        const searchIcon = document.querySelector('.search-icon');
        const searchResults = document.getElementById('searchResults');

        // Cart functions
        function saveCart() {
            localStorage.setItem('kevoCart', JSON.stringify(cart));
        }

        function updateCartUI() {
            // total items (sum of quantities)
            const totalItems = cart.reduce((s, it) => s + (it.quantity || 0), 0);
            cartBadge.textContent = totalItems;

            if (totalItems === 0) {
                cartItemsContainer.innerHTML = `
                    <div class="cart-empty">
                        <div class="cart-empty-emoji">üõí</div>
                        <p>Your cart is empty</p>
                    </div>
                `;
                cartTotal.textContent = 'KSH 0';
            } else {
                let html = '';
                let total = 0;

                cart.forEach((item, index) => {
                    const price = (typeof item.price === 'number') ? item.price : parseInt(String(item.price).replace(/[^0-9]/g, ''), 10) || 0;
                    const qty = item.quantity || 1;
                    total += price * qty;
                    
                    html += `
                        <div class="cart-item">
                            <div class="cart-item-info">
                                <div class="cart-item-name">${item.name} <span style="font-weight:600; color:#666; font-size:12px;">(${item.size || 'N/A'})</span></div>
                                <div class="cart-item-price">${formatPrice(item.price)}</div>
                                <div class="cart-qty-controls">
                                    <button class="qty-btn" onclick="decreaseQuantity(${index})">-</button>
                                    <input class="qty-value" type="number" min="1" value="${qty}" onchange="setQuantity(${index}, this.value)">
                                    <button class="qty-btn" onclick="increaseQuantity(${index})">+</button>
                                </div>
                            </div>
                            <div class="cart-item-line-total">${formatPrice(price * qty)}</div>
                            <button class="cart-item-remove" onclick="removeFromCart(${index})">Remove</button>
                        </div>
                    `;
                });

                cartItemsContainer.innerHTML = html;
                cartTotal.textContent = 'KSH ' + Math.round(total).toLocaleString();
            }
        }

        function getDefaultSize(product) {
            if (!product) return 'N/A';
            if (product.sizes) {
                const parts = String(product.sizes).split(',').map(s => s.trim()).filter(Boolean);
                return parts.length ? parts[0] : 'N/A';
            }
            return 'N/A';
        }

        function addToCart(productName) {
            const product = products.find(p => p.name === productName);
            if (!product) return;

            const size = getDefaultSize(product);
            const existingIndex = cart.findIndex(i => i.name === product.name && (i.size || '') === size);
            const currentQty = existingIndex !== -1 ? (cart[existingIndex].quantity || 1) : 0;
            const available = typeof product.stock === 'number' ? product.stock : (product.stock ? parseInt(product.stock, 10) : Infinity);

            if (currentQty + 1 > available) {
                alert('‚ö†Ô∏è Sorry ‚Äî only ' + available + ' in stock for "' + product.name + '".');
                return;
            }

            if (existingIndex !== -1) {
                cart[existingIndex].quantity = currentQty + 1;
            } else {
                cart.push({ name: product.name, price: product.price, emoji: product.emoji, image: product.image || null, size: size, quantity: 1 });
            }

            saveCart();
            updateCartUI();

            // Show add to cart animation
            cartBadge.style.animation = 'none';
            setTimeout(() => {
                cartBadge.style.animation = 'badgePop 0.3s ease';
            }, 10);
        }

        function removeFromCart(index) {
            cart.splice(index, 1);
            saveCart();
            updateCartUI();
        }

        // Make removeFromCart global
        window.removeFromCart = removeFromCart;

        // Quantity controls (respect stock)
        function increaseQuantity(index) {
            const item = cart[index];
            if (!item) return;
            const product = products.find(p => p.name === item.name);
            const available = typeof product?.stock === 'number' ? product.stock : (product?.stock ? parseInt(product.stock, 10) : Infinity);
            const newQty = (item.quantity || 1) + 1;
            if (newQty > available) {
                alert('‚ö†Ô∏è Cannot add more ‚Äî only ' + available + ' in stock for "' + item.name + '".');
                return;
            }
            item.quantity = newQty;
            saveCart();
            updateCartUI();
        }

        function decreaseQuantity(index) {
            const item = cart[index];
            if (!item) return;
            item.quantity = (item.quantity || 1) - 1;
            if (item.quantity <= 0) {
                cart.splice(index, 1);
            }
            saveCart();
            updateCartUI();
        }

        window.increaseQuantity = increaseQuantity;
        window.decreaseQuantity = decreaseQuantity;

        function setQuantity(index, value) {
            const v = parseInt(value, 10);
            const item = cart[index];
            if (!item) return;
            const product = products.find(p => p.name === item.name);
            const available = typeof product?.stock === 'number' ? product.stock : (product?.stock ? parseInt(product.stock, 10) : Infinity);

            if (isNaN(v) || v <= 0) {
                // remove item
                cart.splice(index, 1);
            } else if (v > available) {
                alert('‚ö†Ô∏è Only ' + available + ' in stock for "' + item.name + '". Quantity set to available stock.');
                item.quantity = available;
            } else {
                item.quantity = v;
            }

            saveCart();
            updateCartUI();
        }

        window.setQuantity = setQuantity;

        // Cart icon click
        cartIcon.addEventListener('click', () => {
            cartModal.classList.add('active');
        });

        // Cart close click
        cartClose.addEventListener('click', () => {
            cartModal.classList.remove('active');
        });

        // Close cart when clicking outside
        cartModal.addEventListener('click', (e) => {
            if (e.target === cartModal) {
                cartModal.classList.remove('active');
            }
        });

        // Cart continue button
        cartContinue.addEventListener('click', () => {
            cartModal.classList.remove('active');
        });

        // Cart checkout button
        cartCheckout.addEventListener('click', () => {
            if (cart.length === 0) {
                alert('üõí Your cart is empty! Add some shoes first.');
            } else {
                openCheckout();
            }
        });

        // --- Checkout modal handling ---
        // Create checkout modal element
        const checkoutModalHtml = `
        <div class="checkout-modal" id="checkoutModal">
            <div class="checkout-panel">
                <div class="checkout-left">
                    <div class="checkout-header">
                        <div>
                            <div style="font-size:18px; font-weight:800">Delivery Details</div>
                            <div style="font-size:12px; color:#666; margin-top:6px">Provide the delivery address and contact details</div>
                        </div>
                        <div class="checkout-close" id="checkoutClose">‚úï</div>
                    </div>

                    <form id="checkoutForm" class="checkout-form">
                        <label for="fullName">Full name</label>
                        <input id="fullName" name="fullName" placeholder="e.g. Jane Doe" required>

                        <label for="phone">Phone number</label>
                        <input id="phone" name="phone" placeholder="e.g. 0712 345 678" required>

                        <label for="email">Email</label>
                        <input id="email" name="email" type="email" placeholder="you@example.com" required>

                        <label for="address1">Address line 1</label>
                        <input id="address1" name="address1" placeholder="House number, street, building" required>

                        <label for="address2">Address line 2 (optional)</label>
                        <input id="address2" name="address2" placeholder="Estate, apartment, etc.">

                        <label for="city">Town / City</label>
                        <input id="city" name="city" placeholder="Nairobi" required>

                        <label for="postal">Postal code</label>
                        <input id="postal" name="postal" placeholder="e.g. 00100" >

                        <label for="landmark">Landmark / Delivery note</label>
                        <input id="landmark" name="landmark" placeholder="Near the mall / opposite ...">

                        <div class="checkout-actions">
                            <button type="button" class="btn-primary" id="proceedPayment">Proceed to Payment</button>
                            <button type="button" class="btn-secondary" id="saveAddress">Save Address</button>
                        </div>
                    </form>
                </div>
                <div class="checkout-right">
                    <div style="font-weight:800; font-size:16px; margin-bottom:8px">Order Summary</div>
                    <div id="checkoutSummary" class="order-summary"></div>
                    <div class="summary-total"><span>Total</span><span id="checkoutTotal">KSH 0</span></div>
                </div>
            </div>
        </div>
        `;

        // Append to body
        document.body.insertAdjacentHTML('beforeend', checkoutModalHtml);

        const checkoutModal = document.getElementById('checkoutModal');
        const checkoutClose = document.getElementById('checkoutClose');
        const checkoutForm = document.getElementById('checkoutForm');
        const proceedPayment = document.getElementById('proceedPayment');
        const saveAddressBtn = document.getElementById('saveAddress');
        const checkoutSummary = document.getElementById('checkoutSummary');
        const checkoutTotalEl = document.getElementById('checkoutTotal');

        function openCheckout() {
            renderCheckoutSummary();
            // populate saved address if any
            const saved = JSON.parse(localStorage.getItem('kevoAddress') || '{}');
            if (saved) {
                ['fullName','phone','email','address1','address2','city','postal','landmark'].forEach(k=>{
                    const el = document.getElementById(k);
                    if (el && saved[k]) el.value = saved[k];
                });
            }
            checkoutModal.classList.add('active');
        }

        function closeCheckout() {
            checkoutModal.classList.remove('active');
        }

        checkoutClose.addEventListener('click', closeCheckout);
        checkoutModal.addEventListener('click', (e)=>{ if (e.target === checkoutModal) closeCheckout(); });

        function renderCheckoutSummary(){
            if (!cart || cart.length===0){ checkoutSummary.innerHTML = '<div class="no-results">Cart is empty</div>'; checkoutTotalEl.textContent = 'KSH 0'; return; }
            let html=''; let total=0;
            cart.forEach(it=>{
                const price = (typeof it.price==='number')?it.price:parseInt(String(it.price).replace(/[^0-9]/g,''),10)||0;
                const qty = it.quantity||1; total += price*qty;
                html += `<div class="order-item"><div><div style="font-weight:700">${it.name}</div><div style="font-size:12px;color:#666">${it.size||'N/A'} x ${qty}</div></div><div>${formatPrice(price*qty)}</div></div>`;
            });
            checkoutSummary.innerHTML = html;
            checkoutTotalEl.textContent = 'KSH ' + Math.round(total).toLocaleString();
        }

        function validateAddress(){
            const required = ['fullName','phone','email','address1','city'];
            const data = {};
            for(const k of ['fullName','phone','email','address1','address2','city','postal','landmark']){
                const el = document.getElementById(k);
                data[k]= el? el.value.trim() : '';
            }
            for(const r of required){ if (!data[r]){ alert('Please fill in '+ r); return null; } }
            return data;
        }

        saveAddressBtn.addEventListener('click', ()=>{
            const data = validateAddress();
            if (!data) return;
            localStorage.setItem('kevoAddress', JSON.stringify(data));
            alert('‚úÖ Address saved');
        });

        proceedPayment.addEventListener('click', ()=>{
            const data = validateAddress();
            if (!data) return;

            // Validate stock again before finalizing
            for (const it of cart) {
                const prod = products.find(p => p.name === it.name);
                const available = typeof prod?.stock === 'number' ? prod.stock : (prod?.stock ? parseInt(prod.stock, 10) : Infinity);
                if (it.quantity > available) {
                    alert('‚ö†Ô∏è Insufficient stock for "' + it.name + '". Available: ' + available + ', Requested: ' + it.quantity);
                    return;
                }
            }

            // Proceed with payment (mock)
            setTimeout(() => {
                alert('‚úÖ Payment successful! Your order is on the way.');
                // Clear cart and update UI
                cart = [];
                saveCart();
                updateCartUI();
                closeCheckout();
            }, 1000);
        });

        // Render products dynamically (sync with admin)
        function renderProducts() {
          const container = document.getElementById('productsContainer');
          // Prefer live admin data from localStorage
          const stored = JSON.parse(localStorage.getItem('kevoShoes'));
          products = stored && Array.isArray(stored) ? stored : products || [];

          if (!products || products.length === 0) {
            container.innerHTML = '<div class="no-results">No products available</div>';
            return;
          }

          let html = '';
          products.forEach((product, index) => {
            const price = (typeof product.price === 'number') ? formatPrice(product.price) : (product.price || 'KSH 0');
            const emoji = product.emoji || 'üëü';
            const imageHTML = product.image ? `<img src="${product.image}" alt="${product.name}">` : `<span class="emoji">${emoji}</span>`;

            html += `
              <div class="product-card" data-index="${index}">
                <div class="product-image${product.image ? '' : ' emoji'}">
                  ${imageHTML}
                </div>
                <div class="product-info">
                  <div class="product-name">${product.name}</div>
                  <div class="product-price">${price}</div>
                  <button class="product-btn" data-index="${index}">Add to Cart</button>
                </div>
              </div>
            `;
          });

          container.innerHTML = html;

          // Attach handlers
          document.querySelectorAll('.product-btn').forEach((btn) => {
            btn.addEventListener('click', function () {
              const idx = parseInt(this.getAttribute('data-index'), 10);
              const prod = products[idx];
              if (!prod) return;
              addToCart(prod.name);
              const old = this.textContent;
              this.textContent = '‚úÖ Added!';
              this.style.backgroundColor = '#4CAF50';
              setTimeout(() => {
                this.textContent = old || 'Add to Cart';
                this.style.backgroundColor = '';
              }, 1400);
            });
          });
        }

        // Initial render and sync
        renderProducts();

        // Re-render when admin updates storage (another tab)
        window.addEventListener('storage', () => {
          const stored = JSON.parse(localStorage.getItem('kevoShoes'));
          if (stored && Array.isArray(stored)) {
            products = stored;
            renderProducts();
            updateCartUI();
          }
        });

        // Search functionality
        searchInput.addEventListener('input', () => {
            const query = searchInput.value.trim().toLowerCase();
            const results = products.filter(p => p.name.toLowerCase().includes(query));
            displaySearchResults(results);
        });

        function displaySearchResults(results) {
            if (results.length === 0) {
                searchResults.innerHTML = '<div class="no-results">No products found</div>';
                searchResults.classList.add('active');
                return;
            }

            let html = '';
            results.forEach(p => {
                html += `
                    <div class="search-result-item" onclick="addToCart('${p.name}')">
                        <div class="search-result-emoji">${p.emoji}</div>
                        <div class="search-result-text">
                            <div class="search-result-name">${p.name}</div>
                            <div class="search-result-price">${formatPrice(p.price)}</div>
                        </div>
                    </div>
                `;
            });

            searchResults.innerHTML = html;
            searchResults.classList.add('active');
        }

        // Hide search results when clicking outside
        document.addEventListener('click', (e) => {
            if (!searchResults.contains(e.target) && e.target !== searchInput) {
                searchResults.classList.remove('active');
            }
        });

        // Initial cart update and render products
        renderProducts();
        updateCartUI();
    </script>
</body>
</html>
